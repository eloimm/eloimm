{
  "hash": "d6128881cfb6c935bfc603c612d2881a",
  "result": {
    "markdown": "---\ntitle: \"Mapes\"\nauthor: \"eloimm\"\ndate: \"\"\ncategories: [maps, code]\nimage: \"2012.png\"\n---\n\n\n# Apunts per a la representació de mapes amb \\`R\\` amb \\`tm_shape()\\`\n\nEn aquest post present una manera més o menys sencilla per a \\*plotear\\* dades en un mapa. Per a fer-ho ens centrarem en les comarques de Catalunya.\n\nÉs important revisar que les unitats territorials i de les dades són els mateixos donat que en els darrers anys s'han creat noves comarques (i municipis) i l'exercici no resultaria.\n\n# El Shapefile (.shp) del territori\n\nCarreguem els poligons del shapefile (el prenem d' \\[aquí\\](https://vangdata.carto.com/tables/shapefiles_catalunya_comarcas/public) on no apareix el Moianès, comarca creada al 2015)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rgdal)\nlibrary(sp)\nlibrary(tidyverse)\nlibrary(tmap)\n\npoligons<- readOGR(\"data/Comarques/shapefiles_catalunya_comarcas.shp\",\n                   \"shapefiles_catalunya_comarcas\",\n                   use_iconv = TRUE, # Sense aquest paràmetre dona errors en els accents per al català\n                   encoding = \"UTF-8\")\n```\n:::\n\n\nPer a visualitzar dades de l'arxiu\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(poligons@data)\n\npoligons@data$nom_comar\n```\n:::\n\n\nPodem operar-hi, per exemple actualitzant la \"Val d'Aran\" per \"Aran\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\npoligons@data$nom_comar <- as.character(poligons@data$nom_comar)\n\npoligons@data$nom_comar[poligons@data$nom_comar==\"Val d'Aran\"] <- \"Aran\"\n\npoligons@data$nom_comar <- sort(poligons@data$nom_comar)\n\npoligons@data$nom_comar <- as.factor(poligons@data$nom_comar)\n```\n:::\n\n\n## Les dades\n\nCarreguem les dades que volem representar:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(file = \"data/dades.RData\")\n```\n:::\n\n\nCreem una col·lumna en les \\`dades\\` que sigui comuna a la de les \\`poligons\\`\n\n\n::: {.cell}\n\n```{.r .cell-code}\n dades$id <- poligons@data$comarca\n```\n:::\n\n\n### 'merge()'\n\nAra podem juntar els objectes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmapa <- merge(poligons, dades, by.x = \"comarca\", by.y= \"id\")\n```\n:::\n\n\n# Dibuixar els mapes\n\nDibuixem els mapes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmp1 <- tm_shape(mapa) + \n  tm_fill(\"2012\", # Columna a pintar\n          palette = \"-RdYlGn\")+\n  tm_layout(frame = FALSE)\n\nmp1\n```\n:::\n\n\n![](2012.png)\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}